"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}axios.defaults.headers.common["Content-Type"]="application/json",axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";var Timer=function(){function Timer(timer){_classCallCheck(this,Timer),this.id=+timer.id,this.description=timer.description;var convertedTimes=[],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=timer.times[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var time=_step.value;convertedTimes.push(new Time(time))}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}this.times=convertedTimes,this.running=timer.running,this.submitRoute=timer.submitRoute}return _createClass(Timer,[{key:"current",value:function(){return this.times[this.times.length-1]}},{key:"pause",value:function(endTime){this.running=!1,this.times[this.times.length-1].end=new Date(1e3*+endTime)}},{key:"continue",value:function(time){this.times.push(new Time(time)),this.running=!0}}]),Timer}(),Time=function Time(time){_classCallCheck(this,Time),this.id=time.id,this.start=new Date(1e3*+time.start),this.end=time.end?new Date(1e3*+time.end):null},CancelToken=axios.CancelToken,source=CancelToken.source(),timeout=null,tracking=new Vue({el:"#stopwatch",delimiters:["[[","]]"],data:{trackingList:[],description:"",api:{get:function(url,data,callback){axios({method:"GET",url:url,params:data,cancelToken:source.token}).then(callback).catch(function(err){return console.error(err)})},post:function(url,data,callback){axios({method:"POST",url:url,params:data,cancelToken:source.token}).then(callback).catch(function(err){return console.error(err)})},put:function(url,data,callback){axios({method:"PUT",url:url,params:data,cancelToken:source.token}).then(callback).catch(function(err){return console.error(err)})},delete:function(url,data,callback){axios({method:"DELETE",url:url,params:data,cancelToken:source.token}).then(callback).catch(function(err){return console.error(err)})}}},mounted:function(){this.loadData()},methods:{loadData:function(){var _this=this;this.api.get(this.$el.dataset.load,{},function(res){var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=res.data.trackingList[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var timer=_step2.value;_this.trackingList.unshift(new Timer(timer))}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}})},newTracking:function(){var _this2=this;this.api.post(this.$el.dataset.new,{description:this.description},function(res){var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=_this2.trackingList[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){_step3.value.pause(res.data.time)}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}_this2.trackingList.unshift(new Timer(res.data.timer)),_this2.description=""})},pauseTracking:function(timer){this.api.post(this.$el.dataset.pause,{id:timer.id},function(res){timer.pause(res.data.end)})},continueTracking:function(timer){var _this3=this;this.api.post(this.$el.dataset.continue,{id:timer.id},function(res){var _iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=_this3.trackingList[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){_step4.value.pause(res.data.time)}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{!_iteratorNormalCompletion4&&_iterator4.return&&_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}timer.continue(res.data.timer)})},deleteTracking:function(timer,timerIndex){var _this4=this;this.api.delete(this.$el.dataset.deleteTracking,{id:timer.id},function(res){_this4.trackingList.splice(timerIndex,1)})},deleteTime:function(timer,timerIndex,timeIndex){var _this5=this;this.api.delete(this.$el.dataset.deleteTime,{id:timer.times[timeIndex].id},function(res){timer.times.splice(timeIndex,1),timer.times.length||_this5.deleteTracking(timer,timerIndex)})},updateDescription:function(timer){var _this6=this;clearTimeout(timeout),timeout=setTimeout(function(){_this6.api.post(_this6.$el.dataset.description,{id:timer.id,description:timer.description},function(res){})},800)}}});